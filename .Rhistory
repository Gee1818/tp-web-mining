library(RSelenium)
library(rvest)
library(netstat)
library(tidyverse)
# Selenium Server (Firefox)
remote_driver <- rsDriver(browser = "firefox", port = free_port(), verbose = F)
remDr <- remote_driver$client
#remDr$open()
remDr$navigate("https://todoshowcase.com/")
remDr$findElement(using = "class name", "modal-body")
popup <- remDr$findElement(using = "class name", "modal-body")
popup$getElementAttribute("innerHTML")[[1]]
btn_cerrar_popup <- popup$findElement("class name", "btn")
btn_cerrar_popup$click()
dropdown <- remDr$findElement(using = "class name", "dropdownSelector")
dropdown$click()
dropdown$click()
btn_dropdown <- dropdown$findElement("class name", "dropdown-toggle")
btn_dropdown$click()
dropdown <- remDr$findElement(using = "class name", "dropdownSelector")
btn_dropdown <- dropdown$findElement("class name", "dropdown-toggle")
btn_dropdown$click()
dropdown <- remDr$findElements(using = "class name", "dropdownSelector")
View(dropdown)
dropdown <- remDr$findElement(using = "class name", "dropdownSelector")
dropdown <- remDr$findElement(using = "class name", "dropdownSelector")
btn_dropdown <- dropdown$findElement("id name", "movieMenu")
btn_dropdown <- dropdown$findElement("id", "movieMenu")
btn_dropdown$click()
data <- data.frame(Problem = NULL, Position = NULL, User = NULL, Country = NULL, Language = NULL, TimeToSolve = NULL)
btn_dropdown$click()
btn_dropdown$click()
# Selenium Server (Firefox)
remote_driver <- rsDriver(browser = "firefox", port = free_port(), verbose = F)
remDr <- remote_driver$client
# 1. Acceder a la pagina
remDr$navigate("https://todoshowcase.com/")
# 2. Cerrar el anuncio emergente
popup <- remDr$findElement(using = "class name", "modal-body")
btn_cerrar_popup <- popup$findElement("class name", "btn")
btn_cerrar_popup$click()
dropdown <- remDr$findElement(using = "class name", "dropdownSelector")
btn_dropdown <- dropdown$findElement("id", "movieMenu")
btn_dropdown$click()
#btn_dropdown <- dropdown$findElement("id", "movieMenu")
btn_dropdown <- dropdown$findElement("css selector", "#movieMenu")
btn_dropdown$click()
btn_dropdown$click()
#btn_dropdown <- dropdown$findElement("id", "movieMenu")
btn_dropdown <- dropdown$findElement("css selector", "button#movieMenu")
btn_dropdown$click()
btn_dropdown$click()
btn_dropdown$click()
#btn_dropdown <- dropdown$findElement("id", "movieMenu")
btn_dropdown <- dropdown$findElement("css selector", "button#movieMenu.dropdown-toggle.ToogleSelector")
btn_dropdown$click()
btn_dropdown$click()
dropdown <- remDr$findElement(using = "class name", "dropdownSelector")
#btn_dropdown <- dropdown$findElement("id", "movieMenu")
btn_dropdown <- dropdown$findElement("css selector", "button#movieMenu.dropdown-toggle.ToogleSelector")
btn_dropdown$getElementText
btn_dropdown$getElementText()
menu_rosario <- remDr$findElement(using = "id", "cartelera_cine_40218")
pelis_rosario <- menu_rosario$findElements("name", "div")
pelis_rosario <- menu_rosario$findElements("class name", "boxfilm")
pelis_rosario <- menu_rosario$findChildElements("class name", "boxfilm")
View(pelis_rosario)
View(pelis_rosario)
urls_pelis <- c()
urls_pelis <- c()
urls_pelis <- character()
View(data)
View(pelis_rosario)
length(pelis_rosario)
pelis_rosario[[1]]$findChildElement("class name", "tag-container")
tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
tag_container$findChildElement("class name", "estreno2")
tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
tag_anticipada$getElementText()
tag_anticipada$getElementText()[[1]]
tag_anticipada$getElementText()[[1]][1]
tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
length(pelis_rosario)
pelis_rosario[[1]]$findChildElement("class name", "afiche-pelicula")$findChildElement("css selector", "a")$getElementAttribute("href")
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tag_container <- peli$findChildElement("class name", "tag-container")
tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
if (tag_anticipada$getElementText()[[1]] == "ANTICIPADA") next
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")
urls_pelis <- c(urls_pelis, url_peli)
}
pelis_rosario[[1]]$findChildElement("class name", "tag-container")$findChildElement("class name", "estreno2")
pelis_rosario[[10]]$findChildElement("class name", "tag-container")$findChildElement("class name", "estreno2")
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tag_container <- peli$findChildElement("class name", "tag-container")
tryCatch(
tag_container$findChildElement("class name", "estreno2"),
error = next
)
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#if (tag_anticipada$getElementText()[[1]] == "ANTICIPADA") next
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")
urls_pelis <- c(urls_pelis, url_peli)
}
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tryCatch(
{
tag_container <- peli$findChildElement("class name", "tag-container")
tag_container$findChildElement("class name", "estreno2")
},
error = next
)
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#if (tag_anticipada$getElementText()[[1]] == "ANTICIPADA") next
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")
urls_pelis <- c(urls_pelis, url_peli)
}
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tryCatch(
{
tag_container <- peli$findChildElement("class name", "tag-container")
tag_container$findChildElement("class name", "estreno2")
},
error = function() next
)
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#if (tag_anticipada$getElementText()[[1]] == "ANTICIPADA") next
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")
urls_pelis <- c(urls_pelis, url_peli)
}
View(urls_pelis)
urls_pelis <- character()
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tryCatch(
{
tag_container <- peli$findChildElement("class name", "tag-container")
tag_container$findChildElement("class name", "estreno2")
},
error = function() {
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")
urls_pelis <- c(urls_pelis, url_peli)
}
)
}
urls_pelis <- character()
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tryCatch(
{
tag_container <- peli$findChildElement("class name", "tag-container")
tag_container$findChildElement("class name", "estreno2")
},
error = function() {
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")
urls_pelis <- c(urls_pelis, url_peli)
}
)
}
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tryCatch(
{
tag_container <- peli$findChildElement("class name", "tag-container")
tag_container$findChildElement("class name", "estreno2")
},
error = function(cond) {
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")
urls_pelis <- c(urls_pelis, url_peli)
}
)
}
View(url_peli)
urls_pelis <- character()
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tryCatch(
{
tag_container <- peli$findChildElement("class name", "tag-container")
tag_container$findChildElement("class name", "estreno2")
},
error = function(cond) {
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")[[1]]
urls_pelis <- c(urls_pelis, url_peli)
}
)
}
View(url_peli)
urls_pelis <- character()
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tryCatch(
{
tag_container <- peli$findChildElement("class name", "tag-container")
tag_container$findChildElement("class name", "estreno2")
},
error = function(cond) {
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")[[1]]
append(urls_pelis, url_peli)
}
)
}
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tag_container <- peli$findChildElement("class name", "tag-container")
tag_anticipada <- tag_container$findChildElements("class name", "estreno2")
if (!!tag_anticipada) next
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")[[1]]
append(urls_pelis, url_peli)
}
length(tag_anticipada)
urls_pelis <- character()
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tag_container <- peli$findChildElement("class name", "tag-container")
tag_anticipada <- tag_container$findChildElements("class name", "estreno2")
if (length(tag_anticipada) > 0) next
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")[[1]]
append(urls_pelis, url_peli)
}
urls_pelis <- character()
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tag_container <- peli$findChildElement("class name", "tag-container")
tag_anticipada <- tag_container$findChildElements("class name", "estreno2")
if (length(tag_anticipada) > 0) next
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")[[1]]
url_pelis <- c(urls_pelis, url_peli)
}
urls_pelis <- character()
#tag_container <- pelis_rosario[[1]]$findChildElement("class name", "tag-container")
#tag_anticipada <- tag_container$findChildElement("class name", "estreno2")
#tag_anticipada$getElementText()[[1]] == "ANTICIPADA"
for (peli in pelis_rosario) {
tag_container <- peli$findChildElement("class name", "tag-container")
tag_anticipada <- tag_container$findChildElements("class name", "estreno2")
if (length(tag_anticipada) > 0) next
afiche <- peli$findChildElement("class name", "afiche-pelicula")
url_peli <- afiche$findChildElement("css selector", "a")$getElementAttribute("href")[[1]]
urls_pelis <- c(urls_pelis, url_peli)
}
urls_pelis
#  4. Para toda pelicula "no anticipada":
#      a. Abrir la pagina de la pelicula
remDr$navigate(urls_pelis[1])
nombre_peli <- remDr$findElement("css selector", "h2")$getElementText()
nombre_peli <- remDr$findElement("css selector", "h2")$getElementText()[[1]]
funciones <- remDr$findElement("class name", "op_days")$findElements()[[2]]
funciones <- remDr$findElement("class name", "op_days")$findElements("css selector", "button")[[2]]
btn_manana <- remDr$findElement("class name", "op_days")$findElements("css selector", "button")[[2]]
btn_manana$click()
btn_manana$getElementText()
btn_manana <- remDr$findElement("class name", "op_days")$findChildElements("css selector", "button")[[2]]
btn_manana$getElementText()
btn_manana$click()
btn_manana <- remDr$findElements("class name", "op_day")[[2]]
btn_manana$getElementText()
btn_manana$click()
btn_manana$click()
remDr$executeScript("arguments[0].click();", list(btn_manana))
remDr$executeScript("arguments[0].click();", list(btn_manana))
remDr$executeScript("arguments[0].click();", list(remDr$findElement("css selector", "h3")))
remDr$executeScript("arguments[0].click();", list(btn_manana)) # Este es un "click JavaScript"
remDr$executeScript("arguments[0].click();", list(remDr$findElement("css selector", "h3")))
#      c. Para cada seccion, extraer opciones de horarios
opciones <- remDr$findElement("id", "ui-accordion-op_cinemas-panel-0")
length(opciones)
length(opciones$findChildElements("css selector", "div"))
opciones[[1]]$getElementText()
#      c. Para cada seccion, extraer opciones de horarios
opciones <- remDr$findElement("id", "ui-accordion-op_cinemas-panel-0")$findChildElements("css selector", "div")
opciones[[1]]$getElementText()
opciones[[2]]$getElementText()
horarios <- opciones[[2]]$findChildElements("css selector", "button")
horarios$getElementText()
unlist(lapply(horarios, function(x) x$getElementText()))
for (horario in horarios) data %>% add_row(Nombre = nombre_peli, Tipo = tipo, Horario = horario)
tipo <- opciones[[1]]$getElementText()
tipo <- opciones[[1]]$getElementText()[[1]]
for (horario in horarios) data %>% add_row(Nombre = nombre_peli, Tipo = tipo, Horario = horario)
horarios <- unlist(lapply(btns_horarios, function(x) x$getElementText()[[1]]))
btns_horarios <- opciones[[i]]$findChildElements("css selector", "button")
btns_horarios <- opciones[[2]]$findChildElements("css selector", "button")
horarios <- unlist(lapply(btns_horarios, function(x) x$getElementText()[[1]]))
for (horario in horarios) data %>% add_row(Nombre = nombre_peli, Tipo = tipo, Horario = horario)
data <- data.frame(Nombre = NULL, Tipo = NULL, Horario = NULL)
for (horario in horarios) data %>% add_row(Nombre = nombre_peli, Tipo = tipo, Horario = horario)
for (horario in horarios) rbind(data, data.frame(Nombre = nombre_peli, Tipo = tipo, Horario = horario))
for (horario in horarios) data <- rbind(data, data.frame(Nombre = nombre_peli, Tipo = tipo, Horario = horario))
View(data)
data <- data.frame(Nombre = NULL, Tipo = NULL, Horario = NULL)
#  4. Para toda pelicula "no anticipada":
for (url in urls_pelis) {
#      a. Abrir la pagina de la pelicula
remDr$navigate(url)
Sys.sleep(1)
#      b. Obtener el nombre de la pelicula
nombre_peli <- remDr$findElement("css selector", "h2")$getElementText()[[1]]
#      c. Hacer click en la "Mañana" y desplegar opciones
btn_manana <- remDr$findElements("class name", "op_day")[[2]]
remDr$executeScript("arguments[0].click();", list(btn_manana)) # Este es un "click JavaScript"
remDr$executeScript("arguments[0].click();", list(remDr$findElement("css selector", "h3")))
#      d. Para cada seccion, extraer opciones de horarios
opciones <- remDr$findElement("id", "ui-accordion-op_cinemas-panel-0")$findChildElements("css selector", "div")
for (i in 1:length(opciones)) {
if (i %% 2 != 0) {
tipo <- opciones[[i]]$getElementText()[[1]]
} else {
btns_horarios <- opciones[[i]]$findChildElements("css selector", "button")
horarios <- unlist(lapply(btns_horarios, function(x) x$getElementText()[[1]]))
for (horario in horarios) data <- rbind(data, data.frame(Nombre = nombre_peli, Tipo = tipo, Horario = horario))
}
}
}
View(data)
View(data)
data <- data.frame(Nombre = NULL, Tipo = NULL, Horario = NULL)
#  4. Para toda pelicula "no anticipada":
for (url in urls_pelis) {
#      a. Abrir la pagina de la pelicula
remDr$navigate(url)
Sys.sleep(1)
#      b. Obtener el nombre de la pelicula
nombre_peli <- remDr$findElement("css selector", "h2")$getElementText()[[1]]
#      c. Hacer click en la "Mañana" y desplegar opciones
btn_manana <- remDr$findElements("class name", "op_day")[[2]]
remDr$executeScript("arguments[0].click();", list(btn_manana)) # Este es un "click JavaScript"
remDr$executeScript("arguments[0].click();", list(remDr$findElement("css selector", "h3")))
Sys.sleep(1)
#      d. Para cada seccion, extraer opciones de horarios
opciones <- remDr$findElement("id", "ui-accordion-op_cinemas-panel-0")$findChildElements("css selector", "div")
for (i in 1:length(opciones)) {
if (i %% 2 != 0) {
tipo <- opciones[[i]]$getElementText()[[1]]
} else {
btns_horarios <- opciones[[i]]$findChildElements("css selector", "button")
horarios <- unlist(lapply(btns_horarios, function(x) x$getElementText()[[1]]))
for (horario in horarios) {
data <- rbind(data, data.frame(Nombre = nombre_peli, Tipo = tipo, Horario = horario))
}
}
}
}
View(data)
data <- data.frame(Nombre = NULL, Tipo = NULL, Horario = NULL)
#  4. Para toda pelicula "no anticipada":
for (url in urls_pelis) {
#      a. Abrir la pagina de la pelicula
remDr$navigate(url)
Sys.sleep(1)
#      b. Obtener el nombre de la pelicula
nombre_peli <- remDr$findElement("css selector", "h2")$getElementText()[[1]]
#      c. Hacer click en la "Mañana" y desplegar opciones
opciones_fechas <- remDr$findElements("class name", "op_day")[[2]]
idx_btn_manana <- ifelse(length(opciones_fechas) > 1, 2, 1)
btn_manana <- remDr$findElements("class name", "op_day")[[idx_btn_manana]]
remDr$executeScript("arguments[0].click();", list(btn_manana)) # Este es un "click JavaScript"
remDr$executeScript("arguments[0].click();", list(remDr$findElement("css selector", "h3")))
Sys.sleep(0.5)
#      d. Para cada seccion, extraer opciones de horarios
opciones <- remDr$findElement("id", "ui-accordion-op_cinemas-panel-0")$findChildElements("css selector", "div")
for (i in 1:length(opciones)) {
if (i %% 2 != 0) {
tipo <- opciones[[i]]$getElementText()[[1]]
} else {
btns_horarios <- opciones[[i]]$findChildElements("css selector", "button")
horarios <- unlist(lapply(btns_horarios, function(x) x$getElementText()[[1]]))
for (horario in horarios) {
data <- rbind(data, data.frame(Nombre = nombre_peli, Tipo = tipo, Horario = horario))
}
}
}
}
data <- data.frame(Nombre = NULL, Tipo = NULL, Horario = NULL)
#  4. Para toda pelicula "no anticipada":
for (url in urls_pelis) {
#      a. Abrir la pagina de la pelicula
remDr$navigate(url)
Sys.sleep(1)
#      b. Obtener el nombre de la pelicula
nombre_peli <- remDr$findElement("css selector", "h2")$getElementText()[[1]]
#      c. Hacer click en la "Mañana" y desplegar opciones
opciones_fechas <- remDr$findElements("class name", "op_day")
idx_btn_manana <- ifelse(length(opciones_fechas) > 1, 2, 1)
btn_manana <- opciones_fechas[[idx_btn_manana]]
remDr$executeScript("arguments[0].click();", list(btn_manana)) # Este es un "click JavaScript"
remDr$executeScript("arguments[0].click();", list(remDr$findElement("css selector", "h3")))
Sys.sleep(0.5)
#      d. Para cada seccion, extraer opciones de horarios
opciones <- remDr$findElement("id", "ui-accordion-op_cinemas-panel-0")$findChildElements("css selector", "div")
for (i in 1:length(opciones)) {
if (i %% 2 != 0) {
tipo <- opciones[[i]]$getElementText()[[1]]
} else {
btns_horarios <- opciones[[i]]$findChildElements("css selector", "button")
horarios <- unlist(lapply(btns_horarios, function(x) x$getElementText()[[1]]))
for (horario in horarios) {
data <- rbind(data, data.frame(Nombre = nombre_peli, Tipo = tipo, Horario = horario))
}
}
}
}
View(data)
data <- data.frame(Nombre = NULL, Tipo = NULL, Horario = NULL)
#  4. Para toda pelicula "no anticipada":
for (url in urls_pelis) {
#      a. Abrir la pagina de la pelicula
remDr$navigate(url)
Sys.sleep(5)
#      b. Obtener el nombre de la pelicula
nombre_peli <- remDr$findElement("css selector", "h2")$getElementText()[[1]]
#      c. Hacer click en la "Mañana" y desplegar opciones
opciones_fechas <- remDr$findElements("class name", "op_day")
idx_btn_manana <- ifelse(length(opciones_fechas) > 1, 2, 1)
btn_manana <- opciones_fechas[[idx_btn_manana]]
remDr$executeScript("arguments[0].click();", list(btn_manana)) # Este es un "click JavaScript"
remDr$executeScript("arguments[0].click();", list(remDr$findElement("css selector", "h3")))
Sys.sleep(0.5)
#      d. Para cada seccion, extraer opciones de horarios
opciones <- remDr$findElement("id", "ui-accordion-op_cinemas-panel-0")$findChildElements("css selector", "div")
for (i in 1:length(opciones)) {
if (i %% 2 != 0) {
tipo <- opciones[[i]]$getElementText()[[1]]
} else {
btns_horarios <- opciones[[i]]$findChildElements("css selector", "button")
horarios <- unlist(lapply(btns_horarios, function(x) x$getElementText()[[1]]))
for (horario in horarios) {
data <- rbind(data, data.frame(Nombre = nombre_peli, Tipo = tipo, Horario = horario))
}
}
}
}
View(data)
write.csv(data, "pelis_showcase.csv", row.names = F)
write.csv(data, "pelis_showcase.csv", row.names = F, fileEncoding = "UTF-8")
View(data)
View(data)
